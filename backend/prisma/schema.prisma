// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["public", "neon_auth"]
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  name      String?
  password  String
  role      String?
  profiles  Profile[]
  payments  Payment[]
  pixTransactions PixTransaction[]
  twoFactorEnabled Boolean @default(false)
  twoFactorSecret String?
  @@schema("public")
}

model Profile {
  id        Int      @id @default(autoincrement())
  userId    Int
  bio       String?
  avatarUrl String?
  user      User     @relation(fields: [userId], references: [id])
  @@schema("public")
}

model Configuration {
  id        Int      @id @default(autoincrement())
  key       String   @unique
  value     String
  @@schema("public")
}

model Domain {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  status    String?
  @@schema("public")
}

model GeneralConfig {
  id        Int      @id @default(autoincrement())
  configKey String   @unique
  configVal String
  @@schema("public")
}

model SuperadminProfile {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  @@schema("public")
}

model Plan {
  id        Int      @id @default(autoincrement())
  name      String
  price     Float
  duration  Int
  @@schema("public")
}

model Payment {
  id        Int      @id @default(autoincrement())
  amount    Float
  status    String
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  @@schema("public")
}

model PixTransaction {
  id        Int      @id @default(autoincrement())
  amount    Float
  status    String
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  @@schema("public")
}

model AccessLog {
  id              Int      @id @default(autoincrement())
  domain_id       Int?
  path            String?
  method          String?
  status_code     Int?
  client_ip       String?
  user_agent      String?
  device_type     String?
  country         String?
  city            String?
  isp             String?
  response_time   Int?
  bytes_transferred Int?
  cache_status    String?
  episode_info    Json?
  session_id      String?
  change_type     String?
  episode_changed Boolean?
  content_id      String?
  accessed_at     DateTime @default(now())
  @@schema("public")
}

// Novos modelos adicionados para cobertura completa do analytics
model GeolocationCache {
  id        Int      @id @default(autoincrement())
  ip        String   @unique
  country   String?
  city      String?
  isp       String?
  deviceInfo Json?
  createdAt DateTime @default(now())
  @@schema("public")
}

model MonthlyTraffic {
  id        Int      @id @default(autoincrement())
  month     String
  trafficMB Float
  createdAt DateTime @default(now())
  @@schema("public")
}

model TrafficMetrics {
  id        Int      @id @default(autoincrement())
  metric    String
  value     Float
  createdAt DateTime @default(now())
  @@schema("public")
}

model DashboardData {
  id        Int      @id @default(autoincrement())
  metric    String?
  value     Float?
  createdAt DateTime @default(now())
  @@schema("public")
}

model NeonAuthUserSync {
  id         String   @id // Remover @default(uuid()) para não conflitar com o banco
  name       String?
  email      String?
  created_at DateTime?
  updated_at DateTime?
  deleted_at DateTime?
  raw_json   Json?

  @@map("users_sync")
  @@schema("neon_auth")
}

model MercadopagoTransaction {
  id        Int      @id @default(autoincrement())
  userId    Int?
  amount    Float?
  status    String?
  createdAt DateTime @default(now())
  @@schema("public")
}

// Modelo StreamingProxy para corrigir erros do serviço
model StreamingProxy {
  id        Int      @id @default(autoincrement())
  name      String
  url       String
  status    String?
  createdAt DateTime @default(now())
  @@schema("public")
}
