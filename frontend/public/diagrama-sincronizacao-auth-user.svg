<svg width="800" height="400" xmlns="http://www.w3.org/2000/svg">
  <style>
    .actor { font: bold 16px sans-serif; }
    .label { font: 14px sans-serif; }
    .arrow { marker-end: url(#arrowhead); }
  </style>
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
    </marker>
  </defs>
  <!-- Actors -->
  <text x="60" y="40" class="actor">Usuário</text>
  <text x="260" y="40" class="actor">Supabase Auth</text>
  <text x="460" y="40" class="actor">Trigger/Função</text>
  <text x="660" y="40" class="actor">public.User</text>

  <!-- Lifelines -->
  <line x1="80" y1="60" x2="80" y2="350" stroke="#888" stroke-dasharray="4" />
  <line x1="280" y1="60" x2="280" y2="350" stroke="#888" stroke-dasharray="4" />
  <line x1="480" y1="60" x2="480" y2="350" stroke="#888" stroke-dasharray="4" />
  <line x1="680" y1="60" x2="680" y2="350" stroke="#888" stroke-dasharray="4" />

  <!-- Messages -->
  <text x="120" y="90" class="label">1. Criação de conta</text>
  <line x1="80" y1="100" x2="280" y2="100" stroke="#333" stroke-width="2" class="arrow" />

  <text x="320" y="130" class="label">2. Registro em auth.users</text>
  <line x1="280" y1="140" x2="480" y2="140" stroke="#333" stroke-width="2" class="arrow" />

  <text x="520" y="170" class="label">3. Trigger/Função aciona</text>
  <line x1="480" y1="180" x2="680" y2="180" stroke="#333" stroke-width="2" class="arrow" />

  <text x="720" y="210" class="label">4. Registro criado em public.User</text>

  <text x="320" y="250" class="label">5. Log de erro (se falhar)</text>
  <line x1="480" y1="260" x2="280" y2="260" stroke="#d33" stroke-width="2" marker-end="url(#arrowhead)" />

  <text x="120" y="290" class="label">6. Fila de retry (se necessário)</text>
  <line x1="280" y1="300" x2="480" y2="300" stroke="#d33" stroke-width="2" marker-end="url(#arrowhead)" />

  <text x="120" y="340" class="label">7. Consulta public.User pelo userId para obter ROLE</text>
  <line x1="80" y1="350" x2="680" y2="350" stroke="#333" stroke-width="2" class="arrow" />
</svg>